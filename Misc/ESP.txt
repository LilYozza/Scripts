print("Version 1.0.5")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local Player = Players.LocalPlayer

local isESP = false
local PlayerCon = {}

local NameTagColor = Color3.fromRGB(255,0,0)


local function CheckPlayer(player)
	for _,v in pairs(Players:GetPlayers())do
		if v == player then return true end
	end
end

local function RemoveESP(player)

	local char = player.Character or player.CharacterAdded:Wait()
	if not char then return end

	local Tag = player.Character.Head:FindFirstChild("PlayerTag") or player.Character:WaitForChild("Head", 5):FindFirstChild("PlayerTag")
	if Tag then Tag:Destroy()end
end

local function CreateTag(player)

	if not CheckPlayer(player) then RemoveESP(player) return end

	local char = player.Character or player.CharacterAdded:Wait()
	if not char then return end
	local head = char:FindFirstChild("Head") or char:WaitForChild("Head", 10)
	if not head then return end

	if head:FindFirstChild("PlayerTag") then return end
	-- Creates BillBoard --
	local newBillBoard = Instance.new("BillboardGui")
	-- Data --
	newBillBoard.Name = "PlayerTag"
	newBillBoard.Parent = head
	newBillBoard.AlwaysOnTop = true
	newBillBoard.ExtentsOffset = Vector3.new(0,2,0)

	-- Creates Name Tag --
	local newText = Instance.new("TextLabel")
	-- Data --
	newText.Name = player.DisplayName
	newText.Parent = newBillBoard
	newText.BackgroundTransparency = 1
	newText.TextScaled = true

	-- Text --
	newText.Font = Enum.Font.FredokaOne
	newText.TextColor3 = NameTagColor

end



function _G.ESPOn()
	pcall(function()
		isESP = true
		for _,v in pairs(Players:GetPlayers())do
			spawn(function()
				if v ~= Player then
					CreateTag(v)
					PlayerCon[v.UserId] = v.CharacterAdded:Connect(function()if isESP == true then CreateTag(v)end end)
				end
			end)
		end
	end)
end

function _G.ESPOff()
	pcall(function()
		isESP = false
		PlayerCon = {}
		for _,v in pairs(Players:GetPlayers())do
			spawn(function()
				if v ~= Player then
					RemoveESP(v)
				end
			end)
		end
	end)
end

Players.PlayerAdded:Connect(function(player)
	PlayerCon[player.UserId] = player.CharacterAdded:Connect(function()
		if isESP == true then spawn(function()CreateTag(player)end) end
	end)
end)

Players.PlayerRemoving:Connect(function(player)
	if PlayerCon[player.UserId] then PlayerCon[player.UserId] = {} end
	RemoveESP(player)
end)


_G.ESPOn()