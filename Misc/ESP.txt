
local Players=game:GetService("Players")
local Player=game.Players.LocalPlayer

local Run = game:GetService("RunService")
local CoreGui = game:GetService("CoreGui")

ESPFuncTbl={UpdateESP,RemoveESP,CreateESP}
local MyChar = Player.Character

local ESPFolder=CoreGui:FindFirstChild("ESP Stuff")
if not ESPFolder then ESPFolder=Instance.new("Folder",CoreGui)ESPFolder.Name="ESP Stuff"end

local PlayerESP=ESPFolder:FindFirstChild("PlayerESP")
local ItemESP=ESPFolder:FindFirstChild("ItemESP")

if not PlayerESP then PlayerESP=Instance.new("Folder",ESPFolder)PlayerESP.Name="PlayerESP"end
if not ItemESP then ItemESP=Instance.new("Folder",ESPFolder)ItemESP.Name="ItemESP"end

local function FindESP(Obj)
	for i, v in next, ItemESP:GetChildren() do
		if v.className == "ObjectValue" then
			if v.Value == Obj then
				return v.Parent
			end
		end
	end

	return nil
end

ESPFuncTbl.UpdateESP=function(Plr)
	if Plr ~= nil then
		local Find = PlayerESP:FindFirstChild("ESP Crap_" .. Plr.Name)
		if Find then
			local PickColor = Color3.new(255,0,0)
			Find.Frame.Names.TextColor3 = PickColor
			Find.Frame.Dist.TextColor3 = Color3.new(0,0,255)
			Find.Frame.Health.TextColor3 = Color3.new(0,255,0)
			local GetChar = Plr.Character
			if MyChar and GetChar then
				local Find2 = MyChar:FindFirstChild("HumanoidRootPart")
				local Find3 = GetChar:FindFirstChild("HumanoidRootPart")
				local Find4 = GetChar:FindFirstChildOfClass("Humanoid")
				
				Find.Frame.Names.Visible = true
				Find.Frame.Dist.Visible = true
				Find.Frame.Health.Visible = true
				
				if Find2 and Find3 then
					local pos = Find3.Position
					local Dist = (Find2.Position - pos).magnitude
					Find.Frame.Dist.Text = "Distance: " .. string.format("%.0f", Dist)
					if Find4 then
						Find.Frame.Health.Text = "Health: " .. string.format("%.0f", Find4.Health)
					else
						Find.Frame.Health.Text = ""
					end
				end
			end
		end
	end
end

ESPFuncTbl.RemoveESP=function(Obj)
	if Obj ~= nil then
		local IsPlr = Obj:IsA("Player")
		local UseFolder = ItemESP
		if IsPlr then UseFolder = PlayerESP end

		local FindESP = ((IsPlr) and UseFolder:FindFirstChild("ESP Crap_" .. Obj.Name)) or FindESP(Obj)
		if FindESP then
			FindESP:Destroy()
		end
	end
end

ESPFuncTbl.CreateESP=function(Obj)
	if Obj ~= nil then
		local IsPlr = Obj:IsA("Player")
		local UseFolder = ItemESP
		local GetChar = ((IsPlr) and Obj.Character) or Obj
		local Head = GetChar:FindFirstChild("Head")
		local t = tick()
		if IsPlr then UseFolder = PlayerESP end
		if Head == nil then
			repeat
				Head = GetChar:FindFirstChild("Head")
				task.wait()
			until Head ~= nil or (tick() - t) >= 10
		end
		if Head == nil then return end
		
		local bb = Instance.new("BillboardGui")
		bb.Adornee = Head
		bb.ExtentsOffset = Vector3.new(0, 1, 0)
		bb.AlwaysOnTop = true
		bb.Size = UDim2.new(0, 5, 0, 5)
		bb.StudsOffset = Vector3.new(0, 3, 0)
		bb.Name = "ESP Crap_" .. Obj.Name
		bb.Parent = UseFolder
		
		local frame = Instance.new("Frame", bb)
		frame.ZIndex = 10
		frame.BackgroundTransparency = 1
		frame.Size = UDim2.new(1, 0, 1, 0)
		
		local TxtName = Instance.new("TextLabel", frame)
		TxtName.Name = "Names"
		TxtName.ZIndex = 10
		TxtName.Text = Obj.Name
		TxtName.BackgroundTransparency = 1
		TxtName.Position = UDim2.new(0, 0, 0, -45)
		TxtName.Size = UDim2.new(1, 0, 10, 0)
		TxtName.Font = "ArialBold"
		TxtName.TextSize = 15 
		TxtName.TextStrokeTransparency = 0.5

		local TxtDist = nil
		local TxtHealth = nil
		if IsPlr then
			TxtDist = Instance.new("TextLabel", frame)
			TxtDist.Name = "Dist"
			TxtDist.ZIndex = 10
			TxtDist.Text = ""
			TxtDist.BackgroundTransparency = 1
			TxtDist.Position = UDim2.new(0, 0, 0, -32)
			TxtDist.Size = UDim2.new(1, 0, 10, 0)
			TxtDist.Font = "ArialBold"
			TxtDist.TextSize = 15 
			TxtDist.TextStrokeTransparency = 0.5

			TxtHealth = Instance.new("TextLabel", frame)
			TxtHealth.Name = "Health"
			TxtHealth.ZIndex = 10
			TxtHealth.Text = ""
			TxtHealth.BackgroundTransparency = 1
			TxtHealth.Position = UDim2.new(0, 0, 0, -19)
			TxtHealth.Size = UDim2.new(1, 0, 10, 0)
			TxtHealth.Font = "ArialBold"
			TxtHealth.TextSize = 15 
			TxtHealth.TextStrokeTransparency = 0.5
		else
			local ObjVal = Instance.new("ObjectValue", bb)
			ObjVal.Value = Obj
		end
		
		local PickColor = Color3.new(255,0,0)
		TxtName.TextColor3 = PickColor

		if IsPlr then
			TxtDist.TextColor3 = Color3.new(0,0,255)
			TxtHealth.TextColor3 = Color3.new(0,255,0)
		end
	end
end